import numpy as np
import pandas as pd
from sklearn.model_selection import train_test_split


def dataset_extraction(dataset_path, split=False, train_size=.7):
    """
    Given the path to the csv file where all the various features are written , these are returned as sets of values

    :param dataset_path: the path to the csv file to be used
    :param split: a boolean value that allows you to derive both benign set and test set
    :param train_size: The percentage of the sample to be allocated to the training set
    :return: A list containing or two values [X,y] or four values [X_train,X_test,y_train,y_test]
    """
    dataset = pd.read_csv(dataset_path).dropna().reset_index(drop=True)
    X = dataset.loc[:, [x for x in dataset.columns if x.startswith('feature')]]
    y = np.array(list(dataset.target_class))

    return train_test_split(X, y, train_size=train_size, random_state=0) if split else [X, y]


def train(model, X, y, init_model=None):
    """
    Given a model supervised training of the model is performed

    :param model: the model that needs to be trained
    :param X: input samples
    :param y: the labels associated with each input sample
    :param init_model:an init of the model
    :return:
    """
    model.fit(X, y, init_model=init_model)


def test(model, X):
    """
    Given a model and a set of samples, the labels associated with them are predicted

    :param model: the model that will perform the prediction
    :param X: input samples
    :return: the list of labels predicted and probability
    """
    prob = model.predict_proba(X)
    return prob[::, 1], np.where(np.argmax(prob, axis=1) == 1, 'malware', 'benign')
